define(function(){angular.module("coreModule").factory("searchTypeahead",[function(){return function(){var e=getUrlParameter("q");$("#searchText").val(decodeURIComponent(e));var a=function(e){var a=$.map(e[1],function(e){return{value:e[0]}});return a},r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"http://suggestqueries.google.com/complete/search?client=youtube&hl=en&sugexp=gsnos%2Cn%3D13&gs_ri=youtube&ds=yt&q=%QUERY",ajax:{type:"GET",dataType:"jsonp"},filter:a}});r.initialize(),$("#searchText").typeahead({hint:!0,highlight:!0,minLength:1},{name:"results",displayKey:"value",source:r.ttAdapter()});var t=function(e,a,r){angular.element("#searchForm").scope().search(a.value)},l=function(e,a,r){$("#searchText").keyup(function(e){13==e.keyCode&&angular.element("#searchForm").scope().search(a.value)})};$("#searchText").on("typeahead:autocompleted",l).on("typeahead:selected",t).keyup(function(e){13==e.keyCode&&angular.element("#searchForm").scope().search($("#searchText").val())}),$("#searchSubmit").on("click",function(){angular.element("#searchForm").scope().search($("#searchText").val())})}}]).factory("player",[function(){return function(e,a,r){if("repeat"!=e)var t="id="+e;else var t="repeat=1";var l=document.getElementById("player");if("repeat"!=e)if(0==a)var n="player.html?"+t+"&kind=yt";else if(1==a)var n="player.html?"+t+"&playlist=1&kind=yt";else if(2==a)var n="player.html?"+t+"&kind=sc";else var n="player.html?"+t+"&playlist=1&kind=sc";else var n="player.html?"+t;if("null"!=r){var i=r.split("$");if("playlist"==i[0])var s=n+"&bp="+i[1]}else var s=n;var o="100%",u="100%";l.innerHTML='<iframe width="'+o+'" height="'+u+'" src="'+s+'" frameborder="0" id="youtubeplayer" allowfullscreen="1"></iframe>'}}]).controller("Player",["$scope","$element","$location","$http","player","$rootScope","$translate","$translatePartialLoader","$timeout",function(e,a,r,t,l,n,i,s,o){function u(e){isPlaying=1==e?!0:!1}function c(a){i("Player").then(function(a){e.Player=a}),i("big_small").then(function(a){e.big_small=a}),o(function(){var r=e.Player+"$"+e.big_small;if("null"!=a){var t=a.split("$");if("playlist"==t[2]){n.kindPlayer="playlist";var i=t[2]+"$"+t[3]}else{n.kindPlayer="search";var i="null"}"repeat"==t[0]?(l("repeat",0,i,r),u(1)):"youtube"==t[0]?(l(t[1],0,i,r),u(1)):"soundcloud"==t[0]?(l(t[1],2,i,r),u(1)):(l(t[1],1,i,r),u(1))}},10)}s.addPart("player"),i.refresh(),e.repeatAll=function(e){console.log("repeat")},e.next=function(e,a,r,i){if("yt"==a)if(1==r)var s="YTplaylist$"+i;else var s="youtube$"+i;else if("sc"==a)var s="soundcloud$"+i;var o=n.kindPlayer;if("search"==o){var p=n.mergedItems,y=0;for(items in p)y++;if(0!=y){var d=p.indexOf(s);p.splice(d,1);var f=p[0],h=n.prevMergedItems;h.push(s),c(f)}else{n.mergedItems=n.prevMergedItems,n.prevMergedItems=[];var f=p[0];c(f)}}else e?t.get(APIurl+"/playlists/"+e+"/next/"+s).then(function(a){if(a.data.finished){var r="repeat$1$playlist$"+e;c(r)}else{var r=a.data.id+"$playlist$"+e;c(r)}}):(u(0),l(null,null,"destroy"))},e.prev=function(e,a,r,i){if("yt"==a)if(1==r)var s="YTplaylist$"+i;else var s="youtube$"+i;else if("sc"==a)var s="soundcloud$"+i;var o=n.kindPlayer;if("search"==o){var p=n.prevMergedItems,y=0;for(items in p)y++;if(0!=y){var d=0;for(items in p){if(d+1==y){var f=p[d],h=n.mergedItems;h.push(p[d]),p.splice(d,1),c(f)}d++}}else{var f=h[0];c(f)}}else e?t.get(APIurl+"/playlists/"+e+"/prev/"+s).then(function(a){if(a.data.finished){var r="repeat$1$playlist$"+e;c(r)}else{var r=a.data.id+"$playlist$"+e;c(r)}}):(u(0),l(null,null,"destroy"))},e.isPlaying=function(){return isPlaying},e.play=function(){var e=angular.element(a),r=$(e).attr("url");c(r)},e.destroy=function(){i("Player").then(function(a){e.Player=a}),o(function(){u(0),l(null,null,"destroy",e.Player)},10)}}]).controller("LoadPlayer",["$scope","$element","$location","player",function(e,a,r,t){function l(e){isPlaying=1==e?!0:!1}l(),e.isPlaying=function(){return isPlaying}}])});